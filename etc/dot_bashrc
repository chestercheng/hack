export YHROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
source $YHROOT/etc/bashutils.sh
namemunge PATH $YHROOT/bin

_hackon_impl() {
  namemunge PATH $YHROOT/usr/$1/bin
  if [ "$(uname)" == "Darwin" ] ; then
    namemunge DYLD_LIBRARY_PATH $YHROOT/usr/$1/lib
  elif [ "$(uname)" == "Linux" ] ; then
    namemunge LD_LIBRARY_PATH $YHROOT/usr/$1/lib
  fi
}

_hackoff_impl() {
  nameremove PATH $YHROOT/usr/$1/bin
  if [ "$(uname)" == "Darwin" ] ; then
    nameremove DYLD_LIBRARY_PATH $YHROOT/usr/$1/lib
  elif [ "$(uname)" == "Linux" ] ; then
    nameremove LD_LIBRARY_PATH $YHROOT/usr/$1/lib
  fi
}

ho() {
  if [ -z "$1" ] ; then echo "usage: hackon [opt|dbg]" ; return ; fi
  if [ -z "$2" ] && [ "$2" == "off" ] ; then
    _hackoff_impl common
    _hackoff_impl $1 # flavor
    return
  fi
  if [ -d "$YHROOT/usr/$1" ]; then
    _hackon_impl common
    _hackon_impl $1 # flavor
  else
    echo "$YHROOT/usr/$1 doesn't exist"
  fi
}

# completion for hclone and hbuild.
_hcommand_cmpl() {
  local hcloned cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"
  opts=`/bin/ls $YHROOT/build.d`
  COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
  return 0
}
complete -F _hcommand_cmpl hclone
complete -F _hcommand_cmpl hbuild

hpytool() {
  local pkgs
  pkgs="nose six paramiko boto cython netcdf4 
  ipython jupyter pythreejs 
  sphinx sphinxcontrib-issuetracker"

  if [ $(uname) == Darwin ] ; then
    # homebrew place openssl in /usr/local/opt/openssl/
    env \
      CPATH=/usr/local/opt/openssl/include:$CPATH \
      LIBRARY_PATH=/usr/local/opt/openssl/lib:$LIBRARY_PATH \
      pip3 install -U "$pkgs"
  elif [ $(uname) == Linux ] ; then
    pip3 install -U "$pkgs"
  fi
}

# vim: set et nu nobomb fenc=utf8 ft=sh ff=unix sw=2 ts=2:
